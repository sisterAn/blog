- é‡ç»˜çš„ä»£ä»·æ˜¯é«˜æ˜‚çš„ï¼Œå› ä¸ºæµè§ˆå™¨å¿…é¡»éªŒè¯DOMæ ‘ä¸Šå…¶ä»–èŠ‚ç‚¹å…ƒç´ çš„å¯è§æ€§ï¼Ÿ
- ä¸èƒ½åœ¨å‡½æ•°å¼ç»„ä»¶ä¸Šä½¿ç”¨Â refÂ å±æ€§ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰å®ä¾‹ï¼Ÿ



### ä¸€ã€class

> **classÂ å£°æ˜**åˆ›å»ºä¸€ä¸ªåŸºäºåŸå‹ç»§æ‰¿çš„ã€å…·æœ‰ç»™å®šåç§°çš„æ–°ç±»ï¼Œå…¶ä¸­æ„é€ å‡½æ•°ï¼ˆ `constructor` ï¼‰æ˜¯å¯é€‰çš„ã€‚

#### 1. class å£°æ˜

ä½¿ç”¨ ES6 class å®šä¹‰ä¸€ä¸ªè®¡æ•°å™¨ï¼š

```js
class Counter extends HTMLElement {
  constructor() {
    super();
    this.onclick = this.clicked.bind(this);
    this.x = 0;
  }
  
  clicked() {
    this.x++;
    window.requestAnimationFrame(this.render.bind(this));
  }
  
  connectedCallback() { this.render(); }

  render() {
    this.textContent = this.x.toString();
  }
}
window.customElements.define('num-counter', Counter);
```



#### 2. class å­—æ®µå£°æ˜

ä½¿ç”¨ ESnext å­—æ®µå£°æ˜å»ºè®®ï¼Œä¸Šè¿°ç¤ºä¾‹å¯ä»¥å†™æˆï¼š

```js
class Counter extends HTMLElement {
  x = 0;

  constructor() {
    super();
    this.onclick = this.clicked.bind(this);
  }

  clicked() {
    this.x++;
    window.requestAnimationFrame(this.render.bind(this));
  }

  connectedCallback() { this.render(); }

  render() {
    this.textContent = this.x.toString();
  }
}
window.customElements.define('num-counter', Counter);
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°ä½¿ç”¨è¯­æ³• x = 0 å£°æ˜çš„å­—æ®µã€‚è¿˜å¯ä»¥å°†æ²¡æœ‰åˆå§‹åŒ–ç¨‹åºçš„å­—æ®µå£°æ˜ä¸º xã€‚é€šè¿‡é¢„å…ˆå£°æ˜å­—æ®µï¼Œç±»å®šä¹‰å˜å¾—æ›´åŠ è‡ªæˆ‘è®°å½•;å®ä¾‹ç»å†è¾ƒå°‘çš„çŠ¶æ€è½¬æ¢ï¼Œå› ä¸ºå£°æ˜çš„å­—æ®µå§‹ç»ˆå­˜åœ¨ã€‚

### 3. super(props)

åœ¨ JavaScript ä¸­ï¼Œ`super`Â æŒ‡çš„æ˜¯çˆ¶ç±»ï¼ˆå³è¶…ç±»ï¼‰çš„æ„é€ å‡½æ•°ã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ä¹‹å‰ï¼Œä½ æ˜¯ä¸èƒ½åœ¨ constructor ä¸­ä½¿ç”¨Â `this`Â å…³é”®å­—çš„ã€‚JavaScript ä¸å…è®¸è¿™ä¸ªè¡Œä¸ºã€‚

```js
class Checkbox extends React.Component {
  constructor(props) {
    // ğŸ”´  è¿˜ä¸èƒ½ä½¿ç”¨ `this`
    super(props);
    // âœ…  ç°åœ¨å¯ä»¥äº†
    this.state = { isOn: true };
  }
  // ...
}
```

JavaScript æœ‰è¶³å¤Ÿåˆç†çš„åŠ¨æœºæ¥å¼ºåˆ¶ä½ åœ¨æ¥è§¦Â `this`Â ä¹‹å‰æ‰§è¡Œçˆ¶ç±»æ„é€ å‡½æ•°ã€‚è€ƒè™‘è€ƒè™‘ä¸€äº›ç±»å±‚æ¬¡ç»“æ„çš„ä¸œè¥¿ï¼š

```js
class Person {
  constructor(name) {
    this.name = name;
  }
}

class PolitePerson extends Person {
  constructor(name) {
    this.greetColleagues(); // ğŸ”´  è¿™æ˜¯ç¦æ­¢çš„ï¼Œå¾€åè§åŸå› 
    super(name);
  }
  greetColleagues() {
    alert('Good morning folks!');
  }
}
```

Â `this.greetColleagues`Â åœ¨Â `super()`Â ç»™Â `this.name`Â èµ‹å€¼å‰å°±å·²ç»æ‰§è¡Œã€‚`this.name`Â æ­¤æ—¶ç”šè‡³å°šæœªå®šä¹‰ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ ·çš„ä»£ç éš¾ä»¥å¾€ä¸‹æ¨æ•²ã€‚

ä¸ºäº†é¿å…è½å…¥è¿™ä¸ªé™·é˜±ï¼Œ**JavaScript å¼ºåˆ¶ä½ åœ¨ä½¿ç”¨Â thisÂ ä¹‹å‰å…ˆè¡Œè°ƒç”¨Â superã€‚**è®©çˆ¶ç±»æ¥å®Œæˆè¿™ä»¶äº‹æƒ…ï¼ï¼š

```js
constructor(props) {
    super(props);
    // âœ… èƒ½ä½¿ç”¨ `this` äº†
    this.state = { isOn: true };
  }
```





#### æ‰©å±•äºŒï¼šIIFEï¼šé¿å…æ±¡æŸ“å…¨å±€å‘½åç©ºé—´

```js
function foo() {...}     // è¿™æ˜¯å®šä¹‰ï¼ŒDeclarationï¼›å®šä¹‰åªæ˜¯è®©è§£é‡Šå™¨çŸ¥é“å…¶å­˜åœ¨ï¼Œä½†æ˜¯ä¸ä¼šè¿è¡Œã€‚

foo();                   // è¿™æ˜¯è¯­å¥ï¼ŒStatementï¼›è§£é‡Šå™¨é‡åˆ°è¯­å¥æ˜¯ä¼šè¿è¡Œå®ƒçš„

// é”™è¯¯å†™æ³•
function foo(...){}();   // å› ä¸º function foo(...){} è¿™ä¸ªéƒ¨åˆ†åªæ˜¯ä¸€ä¸ªå£°æ˜ï¼Œå¯¹äºè§£é‡Šå™¨æ¥è¯´ï¼Œå°±å¥½åƒä½ å†™äº†ä¸€ä¸ªå­—ç¬¦ä¸² "function foo(...){}"ï¼Œå®ƒéœ€è¦ä½¿ç”¨è§£æå‡½æ•°ï¼Œæ¯”å¦‚ eval() æ¥æ‰§è¡Œå®ƒæ‰å¯ä»¥ã€‚æ‰€ä»¥æŠŠ () ç›´æ¥æ”¾åœ¨å£°æ˜åé¢æ˜¯ä¸ä¼šæ‰§è¡Œï¼Œè¿™æ˜¯é”™è¯¯çš„è¯­æ³•ã€‚æˆ‘ä»¬éœ€è¦æŠŠ å£°æ˜ å˜æˆ è¡¨è¾¾å¼ï¼ˆExpressionï¼‰

// æ­£ç¡®å†™æ³•
// å†™æ³• 1
var foo = function () {...};    // è¿™å°±ä¸æ˜¯å®šä¹‰ï¼Œè€Œæ˜¯è¡¨è¾¾å¼äº†ã€‚
foo();
// å†™æ³• 2
(function foo() {...})    // è¿™é‡Œæ˜¯æ•…æ„æ¢è¡Œï¼Œä»¥ä¾¿äºç†è§£ï¼Œå’Œ å†™æ³• 3 æ˜¯ä¸€è‡´çš„
();
// å†™æ³• 3
(function foo(){...}());
// å†™æ³• 4
!function foo() {...}();
// å†™æ³• 5
+function foo() {...}();
// å†™æ³• 6
void function () {
    // è¿™é‡Œæ˜¯çœŸæ­£éœ€è¦çš„ä»£ç 
}();                 
```

